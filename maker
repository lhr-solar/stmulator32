#!/bin/bash

# Check if exactly one argument is passed
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <build|run>"
    exit 1
fi

# Capture the argument
type=$1

# If "build", run the build commands
if [ "$type" == "build" ]; then
    echo "Building the project..."
    cmake ./build/ || { echo "CMake configuration failed"; exit 1; }
    cd build || { echo "Failed to change directory to build"; exit 1; }
    make || { echo "Make failed"; exit 1; }

# If "run", execute the program
elif [ "$type" == "run" ]; then
    if [ ! -f "build/stmulator" ]; then
        echo "Error: 'build/stmulator' does not exist. Did you forget to build?"
        exit 1
    fi
    echo "Running the STMULATOR..."
    ./build/stmulator || { echo "Failed to run stmulator"; exit 1; }

# Handle invalid arguments
else
    echo "Invalid argument. Use 'build' or 'run'."
    exit 1
fi
